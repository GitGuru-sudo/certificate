<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Team Registration</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; max-width:800px; margin:30px auto; padding:0 16px; }
    label { display:block; font-weight:600; margin-top:10px; }
    input[type="text"], textarea { width:100%; padding:8px; margin-top:6px; box-sizing:border-box; }
    button { margin-top:14px; padding:10px 16px; border:none; background:#2563eb; color:white; border-radius:6px; cursor:pointer; }
    .muted { color:#555; font-size:0.9rem; }
    #result { margin-top:14px; padding:12px; border-radius:8px; display:none; }
    #result.success { background:#ecfdf5; color:#065f46; border:1px solid #bbf7d0; }
    #result.error { background:#ffefef; color:#7f1d1d; border:1px solid #fca5a5; }
  </style>
</head>
<body>
  <h1>Team Registration</h1>
  <p class="muted">Fill details. <strong>Idea</strong> is mandatory paragraph. Team lead + at least one team member required.</p>

  <form id="regForm">
    <label>Team Name</label>
    <input type="text" id="team_name" required>

    <label>Team Idea (paragraph)</label>
    <textarea id="idea" rows="4" required></textarea>

    <label>Team Lead Name</label>
    <input type="text" id="team_lead_name" required>

    <label>Team Lead Course</label>
    <input type="text" id="team_lead_course" required>

    <hr>

    <label>Team Member 2 Name (required)</label>
    <input type="text" id="team_member2_name" required>

    <label>Team Member 2 Course (required)</label>
    <input type="text" id="team_member2_course" required>

    <label>Team Member 3 Name (optional)</label>
    <input type="text" id="team_member3_name">

    <label>Team Member 3 Course (optional)</label>
    <input type="text" id="team_member3_course">

    <label>Team Member 4 Name (optional)</label>
    <input type="text" id="team_member4_name">

    <label>Team Member 4 Course (optional)</label>
    <input type="text" id="team_member4_course">

    <label>Team Member 5 Name (optional)</label>
    <input type="text" id="team_member5_name">

    <label>Team Member 5 Course (optional)</label>
    <input type="text" id="team_member5_course">

    <label>Team Member 6 Name (optional)</label>
    <input type="text" id="team_member6_name">

    <label>Team Member 6 Course (optional)</label>
    <input type="text" id="team_member6_course">

    <button type="submit">Register Team</button>
  </form>

  <div id="result"></div>

  <!-- Supabase JS (UMD) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.min.js"></script>

  <script>
    // ---------- CONFIGURE THESE ----------
    const SUPABASE_URL = "https://zgcyqufccguiustbufkl.supabase.co";
    const SUPABASE_ANON_KEY = "YOUR_ANON_KEY"; // replace with your anon key
    const APPS_SCRIPT_URL = ""; // optional: Google Apps Script endpoint
    // -------------------------------------

    const { createClient } = supabase;
    const db = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const form = document.getElementById('regForm');
    const resultBox = document.getElementById('result');

    function showResult(msg, ok=true) {
      resultBox.style.display = 'block';
      resultBox.className = ok ? 'success' : 'error';
      resultBox.innerHTML = msg;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const payload = {
        team_name: document.getElementById("team_name").value.trim(),
        idea: document.getElementById("idea").value.trim(),
        team_lead_name: document.getElementById("team_lead_name").value.trim(),
        team_lead_course: document.getElementById("team_lead_course").value.trim(),
        team_member2_name: document.getElementById("team_member2_name").value.trim(),
        team_member2_course: document.getElementById("team_member2_course").value.trim(),
        team_member3_name: document.getElementById("team_member3_name").value.trim() || null,
        team_member3_course: document.getElementById("team_member3_course").value.trim() || null,
        team_member4_name: document.getElementById("team_member4_name").value.trim() || null,
        team_member4_course: document.getElementById("team_member4_course").value.trim() || null,
        team_member5_name: document.getElementById("team_member5_name").value.trim() || null,
        team_member5_course: document.getElementById("team_member5_course").value.trim() || null,
        team_member6_name: document.getElementById("team_member6_name").value.trim() || null,
        team_member6_course: document.getElementById("team_member6_course").value.trim() || null
      };

      // Validation
      if (!payload.team_name || !payload.idea || !payload.team_lead_name || !payload.team_lead_course ||
          !payload.team_member2_name || !payload.team_member2_course) {
        showResult("⚠️ Please fill all required fields.", false);
        return;
      }

      try {
        // Insert into Supabase
        const { error } = await db.from('registration').insert([payload]);

        if (error) {
          showResult("❌ Error: " + error.message, false);
          return;
        }

        // Show success immediately
        showResult("✅ Team Registered Successfully!", true);
        form.reset();

        // Optional: Call Google Apps Script in background
        if (APPS_SCRIPT_URL) {
          fetch(APPS_SCRIPT_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          }).catch(err => console.warn("Apps Script call failed:", err));
        }

      } catch (err) {
        showResult("❌ Unexpected error: " + err.message, false);
      }
    });
  </script>
</body>
</html>
